<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>å‡¯åœ£ç‹ç¢³å¾ªç¯è®¡åˆ’è¡¨ç”Ÿæˆå™¨</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
:root{
  --primary:#3498db;--success:#2ecc71;--warning:#f39c12;--danger:#e74c3c;--dark:#2c3e50;--light:#f4f6f8;
  --high:#a7e9af;--med:#ffce8a;--low:#f7a399;
}
*{box-sizing:border-box;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif}
body{background:linear-gradient(135deg,#1a2a6c,#b21f1f,#1a2a6c);color:#333;padding:12px;min-height:100vh}
.container{max-width:1400px;margin:0 auto}
header{color:#fff;text-align:center;margin-bottom:20px}
header h1{font-size:1.6rem;margin-bottom:6px}
header .subtitle{font-size:.9rem;opacity:.9}

.top-row{display:flex;gap:12px;flex-wrap:wrap;align-items:flex-start}
.top-row>section{background:#fff;border-radius:8px;padding:12px;box-shadow:0 2px 6px rgba(0,0,0,.15);flex:1 1 260px;min-width:260px}
.top-row h3{font-size:1rem;margin-bottom:8px;border-bottom:1px solid var(--primary);padding-bottom:4px}
.basic-row,.macro-row{display:flex;gap:8px;flex-wrap:wrap}
.basic-row .input-group,.macro-row .input-group{flex:1 1 100px;display:flex;flex-direction:column}
.top-row label{font-size:.8rem;font-weight:600;margin-bottom:4px}
.top-row input,.top-row select{padding:6px 8px;font-size:.8rem;border:1px solid #ccc;border-radius:4px}

.body-type-cards,.plan-cards{display:flex;gap:6px;flex-wrap:wrap}
.body-type-card,.plan-card{flex:1 1 80px;border:1px solid #ccc;border-radius:6px;padding:6px;font-size:.7rem;text-align:center;cursor:pointer;transition:.2s;background:#fff}
.body-type-card.selected,.plan-card.selected{border-color:var(--primary);background:#e5f1ff}
.body-type-card h4,.plan-card h4{font-size:.75rem;margin-bottom:2px}
.body-type-card p,.plan-card p{font-size:.6rem;margin:0;line-height:1.1}

.summary-cards{display:flex;gap:8px;flex-wrap:wrap}
.summary-card{flex:1 1 100px;background:#fff;border-radius:6px;padding:8px;text-align:center;font-size:.75rem}
.summary-card .val{font-size:1rem;font-weight:700;color:var(--primary)}
.summary-card .lab{font-size:.6rem;color:#666}

.btn-row{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0}
.btn-row button{flex:1 1 80px;padding:8px 0;border:none;border-radius:4px;font-size:.8rem;font-weight:600;cursor:pointer;color:#fff}
.btn-calc{background:var(--primary)}
.btn-down{background:var(--success)}
.btn-reset{background:var(--warning)}

.table-wrap{overflow-x:auto}
table{width:100%;border-collapse:collapse;font-size:.75rem}
th,td{border:1px solid #dee2e6;padding:6px 4px;text-align:center}
th{background:#4a5568;color:#fff}
tbody tr.band:nth-child(odd){background:#fff}
tbody tr.band:nth-child(even){background:var(--light)}
thead tr:nth-child(2) .high{background:var(--high);color:#222}
thead tr:nth-child(2) .med{background:var(--med);color:#222}
thead tr:nth-child(2) .low{background:var(--low);color:#222}
tbody tr:nth-child(1) td{background:#e3f2fd;color:#000;font-weight:bold}
.editable{background:#ffffcc}

.notes{background:#fff;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.15);padding:16px 20px;margin-top:20px;font-size:.8rem;line-height:1.6}
.notes h3{margin-bottom:10px;color:var(--dark);font-size:1rem}
.notes ul{margin:0;padding-left:20px}
.notes li{margin-bottom:6px}
.notes .tag{display:inline-block;padding:2px 6px;border-radius:4px;color:#fff;font-weight:bold;margin-right:4px;font-size:.7rem}
.notes .tag.high{background:var(--high);color:#222}
.notes .tag.med{background:var(--med);color:#222}
.notes .tag.low{background:var(--low);color:#222}
footer{color:#fff;text-align:center;font-size:.6rem;margin-top:20px;opacity:.7}
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>å‡¯åœ£ç‹ç¢³å¾ªç¯è®¡åˆ’è¡¨ç”Ÿæˆå™¨<br> åˆ¶ä½œè€…:laine(å‡¯é—¨) æŠ–éŸ³ä¸“å±ç‰ˆ</h1>
    <p class="subtitle">è¾“å…¥ä½“é‡/èº«é«˜/å¹´é¾„ â†’ é€‰èƒšå‹ â†’ é€‰è®­ç»ƒè®¡åˆ’ â†’ ä¸€é”®ç”Ÿæˆ</p>
  </header>

  <div class="top-row">
    <!-- åŸºç¡€ä¿¡æ¯ -->
    <section>
      <h3>åŸºç¡€ä¿¡æ¯</h3>
      <div class="basic-row">
        <div class="input-group"><label>ä½“é‡(kg)</label><input type="number" id="weight" value="75" min="40" max="200"></div>
        <div class="input-group"><label>èº«é«˜(cm)</label><input type="number" id="height" value="178" min="140" max="220"></div>
        <div class="input-group"><label>å¹´é¾„(å²)</label><input type="number" id="age" value="30" min="18" max="80"></div>
        <div class="input-group"><label>æ€§åˆ«</label>
          <select id="gender"><option value="male">ç”·</option><option value="female">å¥³</option></select>
        </div>
      </div>
    </section>

    <!-- èƒšå‹ -->
    <section>
      <h3>èƒšå‹é€‰æ‹©</h3>
      <div class="body-type-cards">
        <div class="body-type-card selected" data-type="ectomorph"><h4>å¤–èƒšå‹</h4><p>æ˜“ç˜¦</p></div>
        <div class="body-type-card" data-type="mesomorph"><h4>ä¸­èƒšå‹</h4><p>è‚Œè‚‰å‹</p></div>
        <div class="body-type-card" data-type="endomorph"><h4>å†…èƒšå‹</h4><p>æ˜“èƒ–</p></div>
      </div>
    </section>

    <!-- è®­ç»ƒè®¡åˆ’ -->
    <section>
      <h3>è®­ç»ƒè®¡åˆ’</h3>
      <div class="plan-cards">
        <div class="plan-card selected" data-plan="1"><h4>ç»ƒ1ä¼‘1</h4><p>å¾ªç¯</p></div>
        <div class="plan-card" data-plan="2"><h4>ç»ƒ2ä¼‘1</h4><p>å¾ªç¯</p></div>
        <div class="plan-card" data-plan="3"><h4>ç»ƒ3ä¼‘1</h4><p>å¾ªç¯</p></div>
      </div>
    </section>

    <!-- å®é‡ -->
    <section>
      <h3>å®é‡è®¾ç½®(g/kg)</h3>
      <div class="macro-row">
        <div class="input-group"><label>ç¢³æ°´</label><input type="number" id="carbsPerKg" value="3.0" step="0.1" min="1" max="10"></div>
        <div class="input-group"><label>è›‹ç™½è´¨</label><input type="number" id="proteinPerKg" value="1.3" step="0.1" min="0.8" max="3"></div>
        <div class="input-group"><label>è„‚è‚ª</label><input type="number" id="fatPerKg" value="1.1" step="0.1" min="0.5" max="2"></div>
      </div>
    </section>

    <!-- æ±‡æ€» -->
    <section>
      <h3>å…³é”®æ•°æ®</h3>
      <div class="summary-cards">
        <div class="summary-card"><span class="val" id="bmrValue">1852</span><div class="lab">åŸºç¡€ä»£è°¢</div></div>
        <div class="summary-card"><span class="val" id="tdeeValue">2352</span><div class="lab">æ¯æ—¥æ€»æ¶ˆè€—</div></div>
        <div class="summary-card"><span class="val" id="proteinValue">98</span><div class="lab">æ¯æ—¥è›‹ç™½(g)</div></div>
        <div class="summary-card"><span class="val" id="carbsValue">1575</span><div class="lab">æ¯å‘¨ç¢³æ°´(g)</div></div>
      </div>
    </section>
  </div>

  <div class="btn-row">
    <button class="btn-calc" id="calculateBtn">è®¡ç®—è®¡åˆ’</button>
    <button class="btn-down" id="downloadBtn">ä¸‹è½½Excel</button>
    <button class="btn-reset" id="resetBtn">é‡ç½®</button>
  </div>

  <div class="table-wrap">
    <table id="planTable">
      <thead>
        <tr><th rowspan="2">é¡¹ç›®</th><th>ä¸€</th><th>äºŒ</th><th>ä¸‰</th><th>å››</th><th>äº”</th><th>å…­</th><th>æ—¥</th></tr>
        <tr id="carbLevelRow">
          <th class="med">ä¸­</th>
          <th class="high">é«˜</th>
          <th class="low">ä½</th>
          <th class="med">ä¸­</th>
          <th class="low">ä½</th>
          <th class="high">é«˜</th>
          <th class="med">ä¸­</th>
        </tr>
      </thead>
      <tbody>
        <tr class="band"><td>è®­ç»ƒéƒ¨ä½</td><td class="editable">ä¼‘æ¯</td><td class="editable">èƒŒ</td><td class="editable">ä¼‘æ¯</td><td class="editable">èƒ¸</td><td class="editable">ä¼‘æ¯</td><td class="editable">è…¿</td><td class="editable">è‚©</td></tr>
        <tr class="band"><td>ç¢³æ°´(g)</td><td id="carb-mon">192</td><td id="carb-tue">412</td><td id="carb-wed">124</td><td id="carb-thu">192</td><td id="carb-fri">124</td><td id="carb-sat">412</td><td id="carb-sun">124</td></tr>
        <tr class="band"><td>è›‹ç™½è´¨(g)</td><td id="protein-mon">118</td><td id="protein-tue">118</td><td id="protein-wed">118</td><td id="protein-thu">118</td><td id="protein-fri">118</td><td id="protein-sat">118</td><td id="protein-sun">118</td></tr>
        <tr class="band"><td>è„‚è‚ª(g)</td><td id="fat-mon">64</td><td id="fat-tue">41</td><td id="fat-wed">137</td><td id="fat-thu">64</td><td id="fat-fri">137</td><td id="fat-sat">41</td><td id="fat-sun">137</td></tr>
        <tr class="band"><td>çƒ­é‡(kcal)</td><td id="cal-mon">1817</td><td id="cal-tue">2490</td><td id="cal-wed">2202</td><td id="cal-thu">1817</td><td id="cal-fri">2202</td><td id="cal-sat">2490</td><td id="cal-sun">2202</td></tr>
        <tr class="band"><td>ç¼ºå£/ç›ˆä½™</td><td id="diff-mon">-535</td><td id="diff-tue">138</td><td id="diff-wed">-150</td><td id="diff-thu">-535</td><td id="diff-fri">-150</td><td id="diff-sat">138</td><td id="diff-sun">-150</td></tr>
      </tbody>
    </table>
  </div>

  <div class="notes">
    <h3>ğŸ“Œ ç¢³å¾ªç¯è®¡åˆ’è¯´æ˜</h3>
    <ul>
      <li><strong>è„‚è‚ªè§„åˆ™ï¼š</strong> é«˜ç¢³æ—¥è„‚è‚ª=ä¸€å‘¨æ€»è„‚è‚ªÃ—15%Ã·2ï¼›ä¸­ç¢³æ—¥è„‚è‚ª=æ€»è„‚è‚ªÃ—35%Ã·3ï¼›ä½ç¢³æ—¥è„‚è‚ª=æ€»è„‚è‚ªÃ—50%Ã·2ã€‚</li>
      <li><strong>è®¡ç®—åŸç†ï¼š</strong> ç¢³æ°´ = ä½“é‡Ã—g/kgÃ—æ¯”ä¾‹ï¼ˆ<span class="tag high">é«˜50%</span> <span class="tag med">ä¸­35%</span> <span class="tag low">ä½15%</span>ï¼‰ï¼›è›‹ç™½è´¨å›ºå®šï¼›è„‚è‚ªæŒ‰ä¸Šè¿°è§„åˆ™ã€‚</li>
      <li><strong>çƒ­é‡æ¢ç®—ï¼š</strong> ç¢³/è›‹ç™½ 4 kcal/gï¼Œè„‚è‚ª 9 kcal/gã€‚</li>
      <li><strong>ç›®æ ‡è°ƒæ•´ï¼š</strong> å‡è„‚æœŸæ¯æ—¥ç¼ºå£â‰ˆ300 kcalï¼Œå¢è‚ŒæœŸç›ˆä½™â‰ˆ300-500 kcalã€‚</li>
      <li><strong>è®­ç»ƒå®‰æ’ï¼š</strong> é«˜ç¢³æ—¥ä»…èƒ¸/è…¿ï¼Œä¸è¿ç»­ï¼›ä¸­ç¢³æ—¥è‚©èƒŒè…¹è‚Œï¼›ä½ç¢³æ—¥ä¼‘æ¯ã€‚</li>
    </ul>
  </div>
  <footer>ç¢³å¾ªç¯è®¡åˆ’è¡¨ç”Ÿæˆå™¨Â© 2025 | laine(å‡¯é—¨) </footer>
</div>

<script>
/* ---------- å·¥å…· ---------- */
const $ = id => document.getElementById(id)

/* ---------- èƒšå‹ ---------- */
const bodyCards = [...document.querySelectorAll('.body-type-card')]
bodyCards.forEach(c => c.addEventListener('click', () => {
  bodyCards.forEach(x => x.classList.remove('selected'))
  c.classList.add('selected')
  setMacros(c.dataset.type)
}))
function setMacros(type){
  const map = {ectomorph:{c:3,p:1.3,f:1.1},mesomorph:{c:2.5,p:1.3,f:0.9},endomorph:{c:2,p:1.3,f:0.8}}
  $('carbsPerKg').value = map[type].c
  $('proteinPerKg').value = map[type].p
  $('fatPerKg').value = map[type].f
  calc()
}

/* ---------- è®­ç»ƒè®¡åˆ’ ---------- */
const planCards = [...document.querySelectorAll('.plan-card')]
planCards.forEach(c => c.addEventListener('click', () => {
  planCards.forEach(x => x.classList.remove('selected'))
  c.classList.add('selected')
  calc()
}))

/* ---------- ä¿®æ­£åçš„ buildScheduleï¼ˆç»ƒ1ä¼‘1 å¼ºåˆ¶ 2é«˜3ä¸­2ä½ï¼‰ ---------- */
function buildSchedule(plan){
  const plan1Fixed = {
    parts : ['ä¼‘æ¯','èƒŒ','ä¼‘æ¯','èƒ¸','ä¼‘æ¯','è…¿','è‚©'],
    carbMap : ['ä¸­','é«˜','ä½','ä¸­','ä½','é«˜','ä¸­']
  }
  if(plan==='1') return plan1Fixed

  /* plan 2 æˆ– 3 æ²¿ç”¨åŸé€»è¾‘ */
  const highParts=['èƒ¸','è…¿'], medParts=['èƒŒ','è‚©','è…¹è‚Œ'], low=['ä¼‘æ¯']
  const planMap={2:{seq:['ç»ƒ','ç»ƒ','ä¼‘'],len:3},3:{seq:['ç»ƒ','ç»ƒ','ç»ƒ','ä¼‘'],len:4}}
  const {seq,len}=planMap[plan]
  const days=[]
  let idx=0
  for(let i=0;i<7;i++){
    days.push({train:seq[idx]==='ç»ƒ'})
    idx=(idx+1)%len
  }
  let hi=0,mi=0
  days.forEach(d=>{
    if(!d.train){d.part=low[0];d.level='ä½';return}
    if(hi<2){
      d.part=highParts[hi%highParts.length]
      d.level='é«˜'
      hi++
    }else if(mi<3){
      d.part=medParts[mi%medParts.length]
      d.level='ä¸­'
      mi++
    }else{
      d.part=low[0]
      d.level='ä½'
    }
  })
  const swap=(i,j)=>{
    [days[i].part,days[i].level,days[j].part,days[j].level]=[days[j].part,days[j].level,days[i].part,days[i].level]
  }
  for(let i=0;i<7;i++){
    const prev=i===0?6:i-1, next=i===6?0:i+1
    if(days[i].level==='é«˜' && days[prev].level==='é«˜') swap(i,next)
    if(days[i].level===days[prev].level && days[i].level!=='ä½'){
      for(let j=0;j<7;j++){
        if(j!==i && days[j].level!==days[i].level && days[j].level!==days[prev===j?next:prev].level){
          swap(i,j)
          break
        }
      }
    }
  }
  return {parts:days.map(d=>d.part),carbMap:days.map(d=>d.level)}
}

/* ---------- ä¸»è®¡ç®— ---------- */
function calc(){
  const w=+$('weight').value,h=+$('height').value,a=+$('age').value,g=$('gender').value
  if(!w||!h||!a){alert('è¯·è¡¥å…¨ä¿¡æ¯');return}
  const cp=+$('carbsPerKg').value,pp=+$('proteinPerKg').value,fp=+$('fatPerKg').value
  const plan=document.querySelector('.plan-card.selected').dataset.plan
  const bmr=g==='male'?10*w+6.25*h-5*a+5:10*w+6.25*h-5*a-161
  const tdee=bmr+500
  const pro=Math.round(pp*w)
  const weekC=Math.round(cp*w*7)
  const weekF=Math.round(fp*w*7)          // ä¸€å‘¨æ€»è„‚è‚ª
  const hc=Math.round(weekC*.5/2)         // é«˜ç¢³æ—¥ç¢³æ°´
  const mc=Math.round(weekC*.35/3)        // ä¸­ç¢³æ—¥ç¢³æ°´
  const lc=Math.round(weekC*.15/2)        // ä½ç¢³æ—¥ç¢³æ°´
  const hf=Math.round(weekF*.15/2)        // é«˜ç¢³æ—¥è„‚è‚ª
  const mf=Math.round(weekF*.35/3)        // ä¸­ç¢³æ—¥è„‚è‚ª
  const lf=Math.round(weekF*.50/2)        // ä½ç¢³æ—¥è„‚è‚ª

  $('bmrValue').textContent=Math.round(bmr)
  $('tdeeValue').textContent=Math.round(tdee)
  $('proteinValue').textContent=pro
  $('carbsValue').textContent=weekC

  const {parts,carbMap}=buildSchedule(plan)
  const dayKeys=['mon','tue','wed','thu','fri','sat','sun']
  const carbNum=dayKeys.map((_,i)=>{
    switch(carbMap[i]){
      case 'é«˜':return hc
      case 'ä¸­':return mc
      case 'ä½':return lc
    }
  })
  const fats=dayKeys.map((_,i)=>{
    switch(carbMap[i]){
      case 'é«˜':return hf
      case 'ä¸­':return mf
      case 'ä½':return lf
    }
  })

  const trParts=document.querySelector('#planTable tbody tr:nth-child(1)')
  const trLevel=document.querySelector('#carbLevelRow')
  parts.forEach((p,i)=>{
    trParts.children[i+1].textContent=p
    trLevel.children[i].className=carbMap[i]==='é«˜'?'high':(carbMap[i]==='ä¸­'?'med':'low')
    trLevel.children[i].textContent=carbMap[i]
  })
  dayKeys.forEach((d,i)=>{
    $(`carb-${d}`).textContent=carbNum[i]
    $(`protein-${d}`).textContent=pro
    $(`fat-${d}`).textContent=fats[i]
    const cal=carbNum[i]*4+pro*4+fats[i]*9
    $(`cal-${d}`).textContent=cal
    const diff=Math.round(cal-tdee)
    $(`diff-${d}`).innerHTML=`<span style="color:${diff>0?(diff>300?'#2ecc71':'#f39c12'):'#e74c3c'}">${diff>0?'+':''}${diff}</span>`
  })
}

/* ---------- å¯¼å‡º&é‡ç½® ---------- */
function dl(){
  const wb=XLSX.utils.book_new()
  const ws=XLSX.utils.table_to_sheet($('planTable'))
  XLSX.utils.book_append_sheet(wb,ws,'ç¢³å¾ªç¯')
  XLSX.writeFile(wb,`ç¢³å¾ªç¯_${$('weight').value}kg.xlsx`)
}
function reset(){
  $('weight').value=75;$('height').value=178;$('age').value=30;$('gender').value='male'
  bodyCards[0].click()
  planCards[0].click()
}

/* ---------- äº‹ä»¶ ---------- */
$('calculateBtn').addEventListener('click',calc)
$('downloadBtn').addEventListener('click',dl)
$('resetBtn').addEventListener('click',reset)
document.querySelectorAll('.editable').forEach(cell=>{
  cell.addEventListener('dblclick',()=>{
    const v=cell.textContent
    cell.innerHTML=`<input value="${v}" style="width:100%;font-size:.7rem">`
    const inp=cell.querySelector('input')
    inp.focus()
    inp.onblur=inp.onkeydown=e=>{
      if(e.type==='blur'||e.key==='Enter'){cell.textContent=inp.value||v}
    }
  })
})

/* ---------- åˆå§‹åŒ– ---------- */
setMacros('ectomorph')
calc()
</script>
</body>
</html>
