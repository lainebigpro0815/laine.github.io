<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é˜¿äº®å¥èº«è¥å…»æ™ºèƒ½å·¥å…·</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* å…¨å±€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #e0f7ff, #ffffff);
            min-height: 100vh;
            color: #334155;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* é¦–é¡µæ ·å¼ */
        .home-container {
            background: #fff;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 40px;
            text-align: center;
        }
        
        .home-container h1 {
            color: #0ea5e9;
            margin-bottom: 10px;
            font-size: 2rem;
        }
        
        .home-subtitle {
            color: #64748b;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2px;
            margin-bottom: 5px;
        }
        
        .tool-card {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            margin: 5px
        }
        
        .tool-card:hover {
            transform: translateY(-5px);
            border-color: #0ea5e9;
            box-shadow: 0 5px 20px rgba(14, 165, 233, 0.2);
        }
        
        .tool-card h2 {
            color: #0ea5e9;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        
        .tool-card p {
            color: #475569;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .tool-features {
            list-style: none;
            text-align: left;
            color: #64748b;
            font-size: 0.9rem;
            text-align: center;
        }
        
        .tool-features li {
            padding: 5px 0;
            padding-left: 20px;
            position: relative;
                display: inline-block;
    text-align: left;
    margin: 0 10px;
        }
        
        .tool-features li:before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: #10b981;
            font-weight: bold;
            
        }
        
        .btn-enter {
            background: #0ea5e9;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }
        
        .btn-enter:hover {
            background: #0284c7;
            transform: scale(1.05);
        }
        
        .badge {
            position: absolute;
            top: 2px;
            right: 2px;
            background: #f59e0b;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .badge.dev {
            background: #94a3b8;
        }
        
        .comparison-table {
            background: #f8fafc;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            text-align: left;
        }
        
        .comparison-table h3 {
            color: #0ea5e9;
            margin-bottom: 20px;
            text-align: center;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #e2e8f0;
        }
        
        th {
            background: #e0f2fe;
            color: #0c4a6e;
            font-weight: 600;
        }
        
        tr:hover {
            background: #f0f9ff;
        }
        
        /* å·¥å…·é¡µé¢æ ·å¼ */
        .tool-page {
            display: none;
        }
        
        /* å‡¯åœ£ç‹ç¢³å¾ªç¯æ ·å¼ */
        :root{
          --primary:#0ea5e9;
          --primary-light:#38bdf8;
          --success:#10b981;
          --warning:#f59e0b;
          --danger:#f43f5e;
          --dark:#1e293b;
          --light:#f8fafc;
          --high:#bae6fd;
          --med:#e0f2fe;
          --low:#fef3c7;
        }
        
        header{color:#0ea5e9;text-align:center;margin-bottom:24px;position:relative;}
        header h1{font-size:1.8rem;margin-bottom:4px;font-weight:700}
        header .subtitle{font-size:.9rem;color:#64748b}
        
        .back-home-btn {
            position: absolute;
            top: 0;
            left: 0;
            background: #94a3b8;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .back-home-btn:hover {
            background: #64748b;
        }
        
        .tabs{display:flex;justify-content:center;margin-bottom:20px;border-bottom:1px solid #cbd5e1}
        .tab-btn{
          padding:10px 20px;
          background:none;
          border:none;
          cursor:pointer;
          font-size:1rem;
          font-weight:600;
          color:#64748b;
          border-bottom:3px solid transparent;
          transition:.3s;
        }
        .tab-btn.active{
          color:#0ea5e9;
          border-bottom-color:#0ea5e9;
        }
        .tab-content{display:none}
        .tab-content.active{display:block}
        
        .top-row{display:flex;gap:16px;flex-wrap:wrap}
        .top-row>section{
          background:#fff;
          border-radius:12px;
          padding:16px;
          box-shadow:0 1px 3px rgba(0,0,0,.08);
          flex:1 1 260px;
          min-width:260px;
        }
        .top-row h3{
          font-size:1rem;
          margin-bottom:10px;
          color:#0ea5e9;
          font-weight:600;
        }
        .basic-row,.macro-row{display:flex;gap:8px;flex-wrap:wrap}
        .basic-row .input-group,.macro-row .input-group{flex:1 1 100px;display:flex;flex-direction:column}
        .top-row label{font-size:.8rem;font-weight:600;margin-bottom:4px}
        .top-row input,.top-row select{
          padding:6px 8px;
          font-size:.8rem;
          border:1px solid #cbd5e1;
          border-radius:6px;
        }
        
        .target-weight-input-group {
          flex: 0 1 auto !important;
          min-width: unset !important;
        }
        
        .target-weight-controls {
          display: flex;
          align-items: center;
          gap: 4px;
          justify-content: center;
        }
        
        .target-weight-controls input {
          width: 50px !important;
          text-align: center;
          margin: 0 2px;
        }
        
        .target-weight-controls button {
          flex: 0 0 20px;
          height:20px;
          border:1px solid var(--primary-light);
          background:#fff;
          color:var(--primary-light);
          border-radius:50%;
          font-size:14px;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
        }
        
        .body-type-cards,.plan-cards{display:flex;gap:6px;flex-wrap:wrap}
        .body-type-card,.plan-card{
          flex:1 1 80px;
          border:1px solid #cbd5e1;
          border-radius:8px;
          padding:8px 4px;
          font-size:.7rem;
          text-align:center;
          cursor:pointer;
          transition:.2s;
          background:#fff;
        }
        .body-type-card:hover,.plan-card:hover{transform:translateY(-1px)}
        .body-type-card.selected,.plan-card.selected{
          border-color:var(--primary);
          background:#e0f2fe;
        }
        .body-type-card h4,.plan-card h4{font-size:.75rem;margin-bottom:2px;color:#0ea5e9}
        .body-type-card p,.plan-card p{font-size:.6rem;margin:0;line-height:1.2;color:#64748b}
        
        .summary-cards{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
        .summary-card{
          flex:1 1 70px;
          background:#f0f9ff;
          border-radius:8px;
          padding:8px;
          text-align:center;
          font-size:.75rem;
        }
        .summary-card .val{font-size:1rem;font-weight:700;color:var(--primary)}
        .summary-card .lab{font-size:.6rem;color:#475569}
        
        .btn-row{display:flex;gap:8px;flex-wrap:wrap;margin:16px 0}
        .btn-row button{
          flex:1 1 100px;
          padding:10px 0;
          border:none;
          border-radius:6px;
          font-size:.85rem;
          font-weight:600;
          cursor:pointer;
          color:#fff;
          transition:.2s;
        }
        .btn-calc{background:var(--primary)}
        .btn-down{background:var(--success)}
        .btn-reset{background:var(--warning)}
        .btn-back{background:var(--dark)}
        .btn-row button:hover{opacity:.9}
        
        .table-wrap{overflow-x:auto;margin-top:16px}
        table{width:100%;border-collapse:collapse;font-size:.75rem}
        th,td{border:1px solid #e2e8f0;padding:6px 4px;text-align:center}
        th{background:#f1f5f9;color:#0ea5e9;font-weight:600}
        tbody tr:nth-child(odd){background:#fff}
        tbody tr:nth-child(even){background:#f8fafc}
        thead tr:nth-child(2) .high{background:var(--high);color:#0c4a6e}
        thead tr:nth-child(2) .med{background:var(--med);color:#0c4a6e}
        thead tr:nth-child(2) .low{background:var(--low);color:#78350f}
        .editable{background:#fffbeb}
        
        .notes{
          background:#fff;
          border-radius:12px;
          box-shadow:0 1px 3px rgba(0,0,0,.08);
          padding:16px 20px;
          margin-top:20px;
          font-size:.8rem;
          line-height:1.6;
          color:#475569;
        }
        .notes h3{margin-bottom:10px;color:#0ea5e9;font-size:1rem}
        .notes ul{margin:0;padding-left:20px}
        .notes li{margin-bottom:6px}
        .notes .tag{display:inline-block;padding:2px 6px;border-radius:4px;color:#fff;font-weight:bold;margin-right:4px;font-size:.7rem}
        .notes .tag.high{background:var(--high);color:#0c4a6e}
        .notes .tag.med{background:var(--med);color:#0c4a6e}
        .notes .tag.low{background:var(--low);color:#78350f}
        footer{color:#94a3b8;text-align:center;font-size:.6rem;margin-top:20px}
        
        .custom-plan{display:none;gap:4px;flex-wrap:wrap;margin-top:8px}
        .custom-plan input{
          flex:1 1 60px;
          font-size:.7rem;
          padding:4px 2px;
          text-align:center;
          border:1px solid #cbd5e1;
          border-radius:4px;
        }
        .target-info{
          background:#fff;
          border-radius:12px;
          padding:16px;
          margin-top:16px;
          box-shadow:0 1px 3px rgba(0,0,0,.08);
        }
        .target-info h3{
          font-size:1rem;
          margin-bottom:8px;
          color:#0ea5e9;
          font-weight:600;
        }
        .target-stats{
          display:flex;
          gap:8px;
          flex-wrap:wrap;
        }
        .target-stat{
          flex:1 1 100px;
          background:#f0f9ff;
          border-radius:8px;
          padding:8px;
          text-align:center;
        }
        .target-stat .value{
          font-size:1.1rem;
          font-weight:700;
          color:var(--primary);
        }
        .target-stat .label{
          font-size:.7rem;
          color:#64748b;
        }
        
        /* æ©™å­ç¢³æ°´æ¸é™ç‰¹å®šæ ·å¼ */
        .orange-section {
          display: none;
        }
        .orange-macro-row {
          display: flex;
          gap: 8px;
          flex-wrap: wrap;
          margin-bottom: 12px;
        }
        .orange-input-group {
          flex: 1 1 100px;
          display: flex;
          flex-direction: column;
        }
        .orange-ratio-cards {
          display: flex;
          gap: 8px;
          flex-wrap: wrap;
          margin-bottom: 12px;
        }
        .orange-ratio-card {
          flex: 1 1 120px;
          border: 1px solid #cbd5e1;
          border-radius: 8px;
          padding: 8px;
          text-align: center;
          cursor: pointer;
          transition: .2s;
          background: #fff;
        }
        .orange-ratio-card.selected {
          border-color: var(--primary);
          background: #e0f2fe;
        }
        .orange-results {
          background: #fff;
          border-radius: 12px;
          padding: 16px;
          margin-top: 16px;
          box-shadow: 0 1px 3px rgba(0,0,0,.08);
        }
        .orange-results h3 {
          font-size: 1rem;
          margin-bottom: 12px;
          color: #0ea5e9;
          font-weight: 600;
        }
        .orange-stats {
          display: flex;
          gap: 8px;
          flex-wrap: wrap;
          margin-bottom: 16px;
        }
        .orange-stat {
          flex: 1 1 120px;
          background: #f0f9ff;
          border-radius: 8px;
          padding: 10px;
          text-align: center;
        }
        .orange-stat .value {
          font-size: 1.1rem;
          font-weight: 700;
          color: var(--primary);
        }
        .orange-stat .label {
          font-size: .7rem;
          color: #64748b;
        }
        .orange-table {
          width: 100%;
          border-collapse: collapse;
          margin-top: 12px;
        }
        .orange-table th, .orange-table td {
          border: 1px solid #e2e8f0;
          padding: 8px;
          text-align: center;
        }
        .orange-table th {
          background: #f1f5f9;
          color: #0ea5e9;
          font-weight: 600;
        }
        
        /* æ–°å¢æ ·å¼ */
        .weight-loss-slider {
          margin: 10px 0;
        }
        
        .weight-loss-slider label {
          display: block;
          margin-bottom: 5px;
          font-weight: 600;
          font-size: 0.8rem;
        }
        
        .slider-container {
          display: flex;
          align-items: center;
          gap: 10px;
        }
        
        .slider-container input[type="range"] {
          flex: 1;
        }
        
        .slider-value {
          min-width: 40px;
          text-align: center;
          font-weight: 600;
          color: var(--primary);
        }
        
        .custom-ratio-inputs {
          display: flex;
          gap: 8px;
          margin-top: 8px;
          flex-wrap: wrap;
        }
        
        .custom-ratio-input {
          flex: 1;
          min-width: 80px;
        }
        
        .custom-ratio-input label {
          font-size: 0.7rem;
          font-weight: 600;
          display: block;
          margin-bottom: 4px;
        }
        
        .custom-ratio-input input {
          width: 100%;
          padding: 4px;
          border: 1px solid #cbd5e1;
          border-radius: 4px;
          text-align: center;
        }
        
        .ratio-sum {
          margin-top: 8px;
          font-size: 0.8rem;
          color: #64748b;
        }
        
        .ratio-sum.error {
          color: var(--danger);
          font-weight: 600;
        }
        
        /* åª’ä½“æŸ¥è¯¢ï¼šé’ˆå¯¹å°å±å¹•è®¾å¤‡çš„ä¼˜åŒ– */
        @media (max-width: 480px) {
          .basic-row .input-group {
            flex: 1 1 100px !important;
          }
          
          .target-weight-input-group {
            flex: 0 1 120px !important;
          }
          
          .target-weight-controls {
            justify-content: flex-start;
          }
          
          .tab-btn {
            padding: 8px 12px;
            font-size: 0.9rem;
          }
          
          .tools-grid {
            grid-template-columns: 1fr;
          }
          
          .home-container {
            padding: 20px;
          }
          
          .home-container h1 {
            font-size: 1.5rem;
          }
          
          .back-home-btn {
            position: relative;
            margin-bottom: 15px;
          }
        }
    </style>
</head>
<body>
    <!-- é¦–é¡µ -->
    <div id="home-page" class="container home-container">
        <h1>é˜¿äº®å¥èº«è¥å…»æ™ºèƒ½å·¥å…·</h1>
        <p class="home-subtitle">é£Ÿè°±åˆ¶å®šæœåŠ¡å¯åŠ vx:ll8819112</p>
        <!-- ä½“è„‚ç‡å‚è€ƒåŒºåŸŸ -->
<div style="text-align:center; margin:0 auto 5px;">   <!-- ç»Ÿä¸€æ§åˆ¶é—´è· -->
    <a href="javascript:void(0)"
       onclick="toggleBodyFatImage()"
       style="color:#E53E3E;font-size:17px;text-decoration:underline;">
        ğŸ“Œ ç‚¹å‡»æŸ¥çœ‹ä½“è„‚ç‡å‚è€ƒå›¾
    </a>
    <div id="bodyfat-container" style="display:none;margin-top:12px;"> <!-- ä¸Šé—´è·åªç»™å®¹å™¨å†…éƒ¨ -->
        <img src="https://img0.baidu.com/it/u=1083536515,1293547436&fm=253&fmt=auto?w=800&h=1067"
             alt="ä½“è„‚ç‡å‚è€ƒ" style="max-width:100%;height:auto;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.15)">
        <p style="margin-top:8px;font-size:.85rem;color:#64748b">å¸¸è§ä½“è„‚ç‡å¤–è§‚å¯¹ç…§ï¼Œä»…ä¾›å‚è€ƒ</p>
    </div>
</div>
<div class="tool-card" onclick="selectTool('orange-carb')">
                <span class="badge">æ–°æ‰‹é€‰è¿™ä¸ª</span>
                <h2>æ©™å­ç¢³æ°´æ¸é™</h2>
                <p>é€šè¿‡é€æ­¥é™ä½ç¢³æ°´åŒ–åˆç‰©æ‘„å…¥é‡,<br>æ¸©å’Œå®ç°å‡è„‚ç›®æ ‡ã€‚</p>
                <ul class="tool-features">
                    <li>é€‚åˆæ–°æ‰‹å…¥é—¨</li>
                    <li>å¹³ç¼“å‡è„‚</li>
                    <li>æ¸é™å¼è°ƒæ•´ç¢³æ°´</li>
                    <li>ä½“è„‚ç‡å¤§äº25</li>
                </ul>
                <button class="btn-enter">ç«‹å³ä½¿ç”¨</button>
            </div>
        <div class="tools-grid">
            <div class="tool-card" onclick="selectTool('kings-cycle')">
                <span class="badge">æ²¡æ‹›äº†å°±é€‰è¿™ä¸ª</span>
                <h2>å‡¯åœ£ç‹ç¢³å¾ªç¯</h2>
                <p>é€šè¿‡å‘¨æœŸæ€§è°ƒæ•´ç¢³æ°´åŒ–åˆç‰©æ‘„å…¥é‡,<br>å®ç°é«˜æ•ˆå‡è„‚å¢è‚Œçš„ç›®æ ‡ã€‚</p>
                <ul class="tool-features">
                    <li>é€‚åˆå¥èº«çˆ±å¥½è€…</li>
                    <li>å¹³å°æœŸå¤§æ€å™¨</li>
                    <li>å‡è„‚é€Ÿåº¦å¿«</li>
                    <li>ä½“è„‚åœ¨20ä»¥ä¸‹</li>
                </ul>
                <button class="btn-enter">ç«‹å³ä½¿ç”¨</button>
            </div>
            <div class="tool-card">
                <span class="badge dev">å¼€å‘ä¸­</span>
                <h2>å¢è‚Œè®¡åˆ’</h2>
                <p>ä¸“ä¸ºå¢è‚Œç›®æ ‡è®¾è®¡çš„è¥å…»è®¡åˆ’ï¼Œå¸®åŠ©æ‚¨é«˜æ•ˆå¢åŠ è‚Œè‚‰è´¨é‡ã€‚</p>
                <ul class="tool-features">
                    <li>é€‚åˆå¢è‚Œéœ€æ±‚è€…</li>
                    <li>é«˜è›‹ç™½é«˜ç¢³æ°´</li>
                    <li>çƒ­é‡ç›ˆä½™è®¾è®¡</li>
                    <li>è‚Œè‚‰åˆæˆä¼˜åŒ–</li>
                </ul>
                <button class="btn-enter" style="background: #94a3b8;" disabled>å¼€å‘ä¸­</button>
            </div>
        </div>

    </div>

    <!-- å‡¯åœ£ç‹ç¢³å¾ªç¯å·¥å…· -->
    <div id="kings-cycle-tool" class="tool-page">
        <div class="container">
            <header style="display:flex; align-items:center; gap:12px;">
    <button class="back-home-btn" onclick="backToHome()"style="position:static;margin:0;font-size:0.8rem;padding:5px 6px;"> è¿”å›</button>
    <div>
        <h1 style="margin:0;">å¥èº«è¥å…»è®¡åˆ’ç”Ÿæˆå™¨</h1>
        <p class="subtitle" style="margin:0;">æ©±çª—æœ‰å„ç§å‡è„‚å¿…å¤‡å¥½ç‰©,æ„Ÿè°¢å„ä½ä¹‰çˆ¶</p>
    </div>
</header>

            <div class="tabs">
                <button class="tab-btn active" data-tab="kings-cycle">å‡¯åœ£ç‹ç¢³å¾ªç¯</button>
                <button class="tab-btn" data-tab="orange-carb">æ©™å­ç¢³æ°´æ¸é™</button>
            </div>

            <!-- å‡¯åœ£ç‹ç¢³å¾ªç¯éƒ¨åˆ† -->
            <div id="kings-cycle" class="tab-content active">
                <!-- å‡¯åœ£ç‹ç¢³å¾ªç¯å†…å®¹ä¿æŒä¸å˜ -->
                <div class="top-row">
                    <!-- åŸºç¡€ä¿¡æ¯ -->
                    <section>
                        <h3>ç¬¬ä¸€æ­¥ï¼šè¾“å…¥åŸºç¡€ä¿¡æ¯</h3>
                        <div class="basic-row">
                            <div class="input-group"><label>å½“å‰ä½“é‡(kg)</label><input type="number" id="weight" value="75" min="40" max="200"></div>
                            <div class="input-group target-weight-input-group">
                                <label>ç›®æ ‡ä½“é‡(Â±5kg)</label>
                                <div class="target-weight-controls">
                                    <button type="button" onclick="adjustTarget(-1)">âˆ’</button>
                                    <input type="tel" id="targetWeight" value="70" min="40" max="200" step="1" pattern="\d*" oninput="clipTargetWeight()">
                                    <button type="button" onclick="adjustTarget(1)">+</button>
                                </div>
                            </div>
                            <div class="input-group"><label>èº«é«˜(cm)</label><input type="number" id="height" value="178" min="140" max="220"></div>
                            <div class="input-group"><label>å¹´é¾„(å²)</label><input type="number" id="age" value="30" min="18" max="80"></div>
                            <div class="input-group"><label>æ€§åˆ«</label>
                                <select id="gender"><option value="male">ç”·</option><option value="female">å¥³</option></select>
                            </div>
                        </div>
                    </section>

                    <!-- èƒšå‹ -->
                    <section>
                        <h3>ç¬¬äºŒæ­¥ï¼šé€‰æ‹©èƒšå‹</h3>
                        <div class="body-type-cards">
                            <div class="body-type-card selected" data-type="ectomorph"><h4>å¤–èƒšå‹</h4><p>æ˜“ç˜¦</p></div>
                            <div class="body-type-card" data-type="mesomorph"><h4>ä¸­èƒšå‹</h4><p>è‚Œè‚‰å‹</p></div>
                            <div class="body-type-card" data-type="endomorph"><h4>å†…èƒšå‹</h4><p>æ˜“èƒ–</p></div>
                        </div>
                        <!-- èƒšå‹å‚è€ƒå›¾ -->
<div style="text-align:center;margin-top:10px;">
  <a href="javascript:void(0)"
     onclick="toggleBodyTypeRef()"
     style="color:#E53E3E;font-size:.85rem;text-decoration:underline;">
    ğŸ“Œ ç‚¹å‡»æŸ¥çœ‹èƒšå‹å‚è€ƒå›¾
  </a>
  <div id="bodytype-ref" style="display:none;margin-top:12px;">
    <img src="https://qcloud.dpfile.com/pc/CqGM_UcCrvGcGH_XM4yXFCYjwgNnaLZ8cSnss-iMlxboDaSWvqnh_75XjQjKtRzN.jpg"  
         alt="èƒšå‹å‚è€ƒ" style="max-width:100%;height:auto;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.15)">
    <p style="margin-top:6px;font-size:.75rem;color:#64748b">å¤–èƒš / ä¸­èƒš / å†…èƒš ä½“å‹å¯¹ç…§ï¼Œä»…ä¾›å‚è€ƒ</p>
  </div>
</div>
                    </section>

                    <!-- è®­ç»ƒè®¡åˆ’ -->
                    <section>
                        <h3>ç¬¬ä¸‰æ­¥ï¼šé€‰æ‹©è®­ç»ƒè®¡åˆ’</h3>
                        <div class="plan-cards">
                            <div class="plan-card selected" data-plan="1"><h4>ç»ƒ1ä¼‘1</h4><p>å¾ªç¯</p></div>
                            <div class="plan-card" data-plan="2"><h4>ç»ƒ2ä¼‘1</h4><p>å¾ªç¯</p></div>
                            <div class="plan-card" data-plan="3"><h4>ç»ƒ3ä¼‘1</h4><p>å¾ªç¯</p></div>
                            <div class="plan-card" data-plan="4"><h4>ç»ƒ4ä¼‘1</h4><p>å¾ªç¯</p></div>
                            <div class="plan-card" data-plan="custom"><h4>è‡ªå®šä¹‰</h4><p>è‡ªç”±</p></div>
                        </div>
                        <div class="custom-plan" id="customPlan">
                            <input placeholder="å‘¨ä¸€" id="cus-mon">
                            <input placeholder="å‘¨äºŒ" id="cus-tue">
                            <input placeholder="å‘¨ä¸‰" id="cus-wed">
                            <input placeholder="å‘¨å››" id="cus-thu">
                            <input placeholder="å‘¨äº”" id="cus-fri">
                            <input placeholder="å‘¨å…­" id="cus-sat">
                            <input placeholder="å‘¨æ—¥" id="cus-sun">
                        </div>
                    </section>

                    <!-- å®é‡ -->
                    <section>
                        <h3>è¥å…»ç´ è®¾ç½®ï¼ˆå·²æ ¹æ®èƒšå‹è‡ªåŠ¨åŒ¹é…ï¼Œæ— éœ€è°ƒæ•´ï¼‰</h3>
                        <div class="macro-row">
                            <div class="input-group"><label>ç¢³æ°´(g/kg)</label><input type="number" id="carbsPerKg" value="3.0" step="0.1" min="1" max="10"></div>
                            <div class="input-group"><label>è›‹ç™½è´¨(g/kg)</label><input type="number" id="proteinPerKg" value="1.3" step="0.1" min="0.8" max="3"></div>
                            <div class="input-group"><label>è„‚è‚ª(g/kg)</label><input type="number" id="fatPerKg" value="1.1" step="0.1" min="0.5" max="2"></div>
                        </div>
                    </section>

                    <!-- æ±‡æ€» -->
                    <section>
                        <h3>æœ€åä¸€æ­¥ï¼šç‚¹å‡»ä¸‹æ–¹è®¡ç®—è®¡åˆ’</h3>
                        <div class="summary-cards">
                            <div class="summary-card"><span class="val" id="bmrValue">1852</span><div class="lab">åŸºç¡€ä»£è°¢</div></div>
                            <div class="summary-card"><span class="val" id="tdeeValue">2352</span><div class="lab">æ¯æ—¥æ€»æ¶ˆè€—</div></div>
                            <div class="summary-card"><span class="val" id="proteinValue">98</span><div class="lab">æ¯æ—¥è›‹ç™½(g)</div></div>
                            <div class="summary-card"><span class="val" id="carbsValue">1575</span><div class="lab">æ¯å‘¨ç¢³æ°´(g)</div></div>
                        </div>
                    </section>
                </div>

                <div class="btn-row">
                    <button class="btn-calc" id="calculateBtn">è®¡ç®—è®¡åˆ’</button>
                    <button class="btn-down" id="downloadBtn">ä¸‹è½½Excel(ç”µè„‘ç«¯)</button>
                    <button class="btn-reset" id="resetBtn">é‡ç½®</button>
                    <button class="btn-back" onclick="backToHome()">è¿”å›é¦–é¡µ</button>
                </div>

                <div class="target-info">
                    <h3>ç›®æ ‡ä½“é‡åˆ†æ<br>éœ€è¦ç¢³å¾ªç¯é£Ÿè°±å¯ç§ä¿¡ä¸»åŒ…æˆ–å¾®ä¿¡(æœ‰å¿): ll8819112</h3>
                    <div class="target-stats">
                        <div class="target-stat">
                            <div class="value" id="weightDiffValue">-5</div>
                            <div class="label">ä½“é‡å·®(kg)</div>
                        </div>
                        <div class="target-stat">
                            <div class="value" id="weeklyCalorieDiffValue">-1400</div>
                            <div class="label">å‘¨çƒ­é‡å·®(kcal)</div>
                        </div>
                        <div class="target-stat">
                            <div class="value" id="daysNeededValue">42</div>
                            <div class="label">é¢„è®¡å¤©æ•°</div>
                        </div>
                        <div class="target-stat">
                            <div class="value" id="targetDate">2023-12-24</div>
                            <div class="label">å‡æ‰5å…¬æ–¤çº¯è„‚è‚ªçš„é¢„è®¡å®Œæˆæ—¥æœŸ</div>
                        </div>
                    </div>
                </div>

                <div class="table-wrap">
                    <table id="planTable">
                        <thead>
                            <tr><th rowspan="2">é¡¹ç›®</th><th>ä¸€</th><th>äºŒ</th><th>ä¸‰</th><th>å››</th><th>äº”</th><th>å…­</th><th>æ—¥</th></tr>
                            <tr id="carbLevelRow">
                                <th class="med">ä¸­</th>
                                <th class="high">é«˜</th>
                                <th class="low">ä½</th>
                                <th class="med">ä¸­</th>
                                <th class="low">ä½</th>
                                <th class="high">é«˜</th>
                                <th class="med">ä¸­</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="band"><td>è®­ç»ƒéƒ¨ä½<br>(å¯åŒå‡»è‡ªå®šä¹‰)</td><td class="editable">ä¼‘æ¯</td><td class="editable">èƒ¸+ä¸‰å¤´</td><td class="editable">ä¼‘æ¯</td><td class="editable">èƒŒ+äºŒå¤´</td><td class="editable">ä¼‘æ¯</td><td class="editable">è…¿+è‚©</td><td class="editable">ä¼‘æ¯</td></tr>
                            <tr class="band"><td>ç¢³æ°´(g)</td><td id="carb-mon">192</td><td id="carb-tue">412</td><td id="carb-wed">124</td><td id="carb-thu">192</td><td id="carb-fri">124</td><td id="carb-sat">412</td><td id="carb-sun">124</td></tr>
                            <tr class="band"><td>è›‹ç™½è´¨(g)</td><td id="protein-mon">118</td><td id="protein-tue">118</td><td id="protein-wed">118</td><td id="protein-thu">118</td><td id="protein-fri">118</td><td id="protein-sat">118</td><td id="protein-sun">118</td></tr>
                            <tr class="band"><td>è„‚è‚ª(g)</td><td id="fat-mon">64</td><td id="fat-tue">41</td><td id="fat-wed">137</td><td id="fat-thu">64</td><td id="fat-fri">137</td><td id="fat-sat">41</td><td id="fat-sun">137</td></tr>
                            <tr class="band"><td>çƒ­é‡(kcal)</td><td id="cal-mon">1817</td><td id="cal-tue">2490</td><td id="cal-wed">2202</td><td id="cal-thu">1817</td><td id="cal-fri">2202</td><td id="cal-sat">2490</td><td id="cal-sun">2202</td></tr>
                            <tr class="band"><td>ç¼ºå£/ç›ˆä½™</td><td id="diff-mon">-535</td><td id="diff-tue">138</td><td id="diff-wed">-150</td><td id="diff-thu">-535</td><td id="diff-fri">-150</td><td id="diff-sat">138</td><td id="diff-sun">-150</td></tr>
                        </tbody>
                    </table>
                </div>

                <div class="notes">
                    <h3>ğŸ“Œ ç¢³å¾ªç¯è®¡åˆ’è¯´æ˜</h3>
                    <ul>
                        <li>å¦‚æœä½ éª¨æ¶å°ã€è‚©çª„ã€åƒä¸èƒ–ã€å¢è‚Œæ…¢ï¼š<strong>â†’ åå¤–èƒšå‹</strong></li>
                        <li>å¦‚æœä½ è‚©å®½è…°çª„ã€è‚Œè‚‰å®¹æ˜“é•¿ï¼š<strong>â†’ åä¸­èƒšå‹</strong></li>
                        <li>å¦‚æœä½ éª¨æ¶å¤§ã€è…°è…¹æ˜“å›¤è‚‰ï¼š<strong>â†’ åå†…èƒšå‹</strong></li>
                        <li><span class="tag high">é«˜ç¢³æ—¥</span>ï¼šç¢³æ°´å å‘¨æ€»ç¢³æ°´çš„50%ï¼Œå»ºè®®æ‘„å…¥ç²¾åˆ¶ç¢³æ°´ï¼ˆå¦‚ç™½ç±³ã€ç™½é¢åŒ…ï¼‰</li>
                        <li><span class="tag med">ä¸­ç¢³æ—¥</span>ï¼šç¢³æ°´å å‘¨æ€»ç¢³æ°´çš„35%ï¼Œå»ºè®®æ··åˆç²¾ç¢³å’Œç²—ç¢³</li>
                        <li><span class="tag low">ä½ç¢³æ—¥</span>ï¼šç¢³æ°´å å‘¨æ€»ç¢³æ°´çš„15%ï¼Œå»ºè®®æ‘„å…¥ç²—ç¢³ï¼ˆå¦‚ç³™ç±³ã€ç‡•éº¦ï¼‰</li>
                        <li><strong>çƒ­é‡æ¢ç®—ï¼š</strong> ç¢³/è›‹ç™½ 4 kcal/gï¼Œè„‚è‚ª 9 kcal/gã€‚</li>
                        <li><strong>ä½“é‡å˜åŒ–ä¼°ç®—ï¼š</strong> æ¯å‡å°‘7700 kcalçƒ­é‡çº¦å‡å°‘1 kgä½“é‡ï¼Œæ¯å¢åŠ 7700 kcalçƒ­é‡çº¦å¢åŠ 1 kgä½“é‡ã€‚</li>
                    </ul>
                </div>
            </div>

            <!-- æ©™å­ç¢³æ°´æ¸é™éƒ¨åˆ† -->
            <div id="orange-carb" class="tab-content">
                <div class="top-row">
                    <!-- åŸºç¡€ä¿¡æ¯ -->
                    <section>
                        <h3>ç¬¬ä¸€æ­¥ï¼šè¾“å…¥åŸºç¡€ä¿¡æ¯</h3>
                        <div class="basic-row">
                            <div class="input-group"><label>å½“å‰ä½“é‡(kg)</label><input type="number" id="orange-weight" value="80" min="40" max="200"></div>
                            <div class="input-group"><label>èº«é«˜(cm)</label><input type="number" id="orange-height" value="175" min="140" max="220"></div>
                            <div class="input-group"><label>å¹´é¾„(å²)</label><input type="number" id="orange-age" value="32" min="18" max="80"></div>
                            <div class="input-group"><label>æ€§åˆ«</label>
                                <select id="orange-gender"><option value="male">ç”·</option><option value="female">å¥³</option></select>
                            </div>
                        </div>
                    </section>

                    <!-- è®­ç»ƒä¿¡æ¯ -->
                    <section>
                        <h3>ç¬¬äºŒæ­¥ï¼šè®­ç»ƒä¿¡æ¯</h3>
                        <div class="orange-input-group">
                            <label>è®­ç»ƒæ—¶é•¿(åˆ†é’Ÿ)</label>
                            <input type="number" id="train-time" value="60" min="30" max="180">
                        </div>
                        <div class="orange-input-group">
                            <label>è®­ç»ƒå¼ºåº¦ç³»æ•°</label>
                            <select id="train-intensity">
                                <option value="5">æ–°æ‰‹/å¥³ç”Ÿ (5)</option>
                                <option value="8" selected>æ™®é€šå¥èº«çˆ±å¥½è€… (8)</option>
                                <option value="10">é«˜å¼ºåº¦è®­ç»ƒè€… (10)</option>
                            </select>
                        </div>
                    </section>

                    <!-- è¥å…»ç´ æ¯”ä¾‹ -->
                    <section>
                        <h3>ç¬¬ä¸‰æ­¥ï¼šé€‰æ‹©è¥å…»ç´ æ¯”ä¾‹</h3>
                        <div class="orange-ratio-cards">
                            <div class="orange-ratio-card selected" data-ratio="532">
                                <h4>532æ¯”ä¾‹</h4>
                                <p>ç¢³æ°´50% è›‹ç™½30% è„‚è‚ª20%</p>
                            </div>
                            <div class="orange-ratio-card" data-ratio="442">
                                <h4>442æ¯”ä¾‹<br>(ç¢³æ°´å¸æ”¶è¾ƒå¥½)</h4>
                                <p>ç¢³æ°´40% è›‹ç™½40% è„‚è‚ª20%</p>
                            </div>
                            <div class="orange-ratio-card" data-ratio="custom">
                                <h4>è‡ªå®šä¹‰æ¯”ä¾‹</h4>
                                <p>è‡ªå®šä¹‰è¥å…»ç´ æ¯”ä¾‹</p>
                            </div>
                        </div>
                        
                        <!-- è‡ªå®šä¹‰æ¯”ä¾‹è¾“å…¥ -->
                        <div id="custom-ratio-inputs" style="display: none; margin-top: 10px;">
                            <div class="custom-ratio-inputs">
                                <div class="custom-ratio-input">
                                    <label>ç¢³æ°´(%)</label>
                                    <input type="number" id="custom-carb" value="50" min="0" max="100">
                                </div>
                                <div class="custom-ratio-input">
                                    <label>è›‹ç™½è´¨(%)</label>
                                    <input type="number" id="custom-protein" value="30" min="0" max="100">
                                </div>
                                <div class="custom-ratio-input">
                                    <label>è„‚è‚ª(%)</label>
                                    <input type="number" id="custom-fat" value="20" min="0" max="100">
                                </div>
                            </div>
                            <div class="ratio-sum" id="ratio-sum">æ€»å’Œ: 100%</div>
                        </div>
                    </section>
                    
                    <!-- å‡é‡ç›®æ ‡ -->
                    <section>
                        <h3>ç¬¬å››æ­¥ï¼šè®¾ç½®å‡é‡ç›®æ ‡</h3>
                        <div class="weight-loss-slider">
                            <label>æ¯æœˆå‡é‡ç™¾åˆ†æ¯” (3-5%)</label>
                            <div class="slider-container">
                                <input type="range" id="weight-loss-percent" min="3" max="5" step="0.1" value="3.5">
                                <span class="slider-value" id="weight-loss-value">3.5%</span>
                            </div>
                        </div>
                    </section>
                </div>

                <div class="btn-row">
                    <button class="btn-calc" id="orange-calculateBtn">è®¡ç®—è®¡åˆ’</button>
                    <button class="btn-down" id="orange-downloadBtn">ä¸‹è½½Excel(ç”µè„‘ç«¯)</button>
                    <button class="btn-reset" id="orange-resetBtn">é‡ç½®</button>
                    <button class="btn-back" onclick="backToHome()">è¿”å›é¦–é¡µ</button>
                </div>

                <div class="orange-results">
                    <h3>æ‚¨çš„ç¢³æ°´æ¸é™è®¡åˆ’</h3>
                    <div class="orange-stats">
                        <div class="orange-stat">
                            <div class="value" id="orange-bmrValue">0</div>
                            <div class="label">åŸºç¡€ä»£è°¢(BMR)</div>
                        </div>
                        <div class="orange-stat">
                            <div class="value" id="orange-trainCalories">0</div>
                            <div class="label">è®­ç»ƒæ¶ˆè€—çƒ­é‡</div>
                        </div>
                        <div class="orange-stat">
                            <div class="value" id="orange-tdeeValue">0</div>
                            <div class="label">æ¯æ—¥æ€»æ¶ˆè€—(TDEE)</div>
                        </div>
                        <div class="orange-stat">
                            <div class="value" id="orange-initialCarbs">0</div>
                            <div class="label">åˆå§‹ç¢³æ°´(g)</div>
                        </div>
                    </div>

                    <div class="orange-stats">
                        <div class="orange-stat">
                            <div class="value" id="orange-protein">0</div>
                            <div class="label">è›‹ç™½è´¨(g)</div>
                        </div>
                        <div class="orange-stat">
                            <div class="value" id="orange-fat">0</div>
                            <div class="label">è„‚è‚ª(g)</div>
                        </div>
                        <div class="orange-stat">
                            <div class="value" id="orange-weeklyLoss">0</div>
                            <div class="label">å‘¨å‡é‡ç›®æ ‡(kg)</div>
                        </div>
                        <div class="orange-stat">
                            <div class="value" id="orange-adjustment">15</div>
                            <div class="label">ç¢³æ°´è°ƒæ•´é‡(g)</div>
                        </div>
                    </div>
                    
                    <div class="orange-stats">
                      
                    </div>

                    <h4>ç¢³æ°´æ¸é™è®¡åˆ’è¡¨:éœ€è¦è®­ç»ƒè®¡åˆ’å’Œé£Ÿè°±<br>å¯ç§ä¿¡æˆ–æ·»åŠ å¾®ä¿¡(æœ‰å¿): ll8819112</h4>
                    <div class="table-wrap">
                        <table class="orange-table" id="orange-planTable">
                            <thead>
                                <tr>
                                    <th>å‘¨æ•°</th>
                                    <th>æ¯æ—¥ç¢³æ°´(g)</th>
                                    <th>æ¯æ—¥è›‹ç™½è´¨(g)</th>
                                    <th>æ¯æ—¥è„‚è‚ª(g)</th>
                                    <th>é¢„æœŸä½“é‡(kg)</th>
                                    <th>å‘¨å‡é‡ç›®æ ‡(kg)</th>
                                    <th>è°ƒæ•´è¯´æ˜</th>
                                </tr>
                            </thead>
                            <tbody id="orange-planBody">
                                <!-- è®¡åˆ’å†…å®¹å°†é€šè¿‡JSç”Ÿæˆ -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="notes">
                    <h3>ğŸ“Œ ç¢³æ°´æ¸é™è®¡åˆ’è¯´æ˜</h3>
                    <ul>
                        <li><strong>è®¡ç®—åŸºç¡€ä»£è°¢(BMR)ï¼š</strong> ä½¿ç”¨ Mifflin-St Jeor å…¬å¼è®¡ç®—</li>
                        <li><strong>è®­ç»ƒæ¶ˆè€—çƒ­é‡ï¼š</strong> è®­ç»ƒæ—¶é•¿(åˆ†é’Ÿ) Ã— å¼ºåº¦ç³»æ•°</li>
                        <li><strong>æ¯æ—¥æ€»æ¶ˆè€—(TDEE)ï¼š</strong> BMR + è®­ç»ƒæ¶ˆè€—çƒ­é‡</li>
                        <li><strong>åˆå§‹ç¢³æ°´è®¡ç®—ï¼š</strong> TDEE Ã— ç¢³æ°´æ¯”ä¾‹ Ã· 4</li>
                        <li><strong>å‘¨å‡é‡ç›®æ ‡ï¼š</strong> æ¯æœˆå‡é‡3-5%ï¼Œå¹³å‡åˆ°æ¯å‘¨</li>
                        <li><strong>ç¢³æ°´è°ƒæ•´ï¼š</strong> æ¯å‘¨å¦‚æœªè¾¾åˆ°å‡é‡ç›®æ ‡ï¼Œå‡å°‘ç¢³æ°´15-30g</li>
                        <li><strong>åœæ­¢è°ƒæ•´ï¼š</strong> å½“ç¢³æ°´é™è‡³100gå·¦å³æˆ–è¾¾åˆ°ç†æƒ³ä½“è„‚ç‡æ—¶åœæ­¢</li>
                    </ul>
                </div>
            </div>

            <footer>é˜¿äº®å¥èº«è¥å…»æ™ºèƒ½å·¥å…·Â© 2025 Â· é˜¿äº®å¥èº«(å‡¯é—¨)</footer>
        </div>
    </div>

    <script>
        // é¡µé¢å¯¼èˆªåŠŸèƒ½
        function selectTool(tool) {
            document.getElementById('home-page').style.display = 'none';
            
            if (tool === 'kings-cycle') {
                document.getElementById('kings-cycle-tool').style.display = 'block';
                // é»˜è®¤æ¿€æ´»å‡¯åœ£ç‹ç¢³å¾ªç¯é€‰é¡¹å¡
                document.querySelector('.tab-btn[data-tab="kings-cycle"]').click();
            } else if (tool === 'orange-carb') {
                document.getElementById('kings-cycle-tool').style.display = 'block';
                // æ¿€æ´»æ©™å­ç¢³æ°´æ¸é™é€‰é¡¹å¡
                document.querySelector('.tab-btn[data-tab="orange-carb"]').click();
            }
        }
        
        function backToHome() {
            document.getElementById('kings-cycle-tool').style.display = 'none';
            document.getElementById('home-page').style.display = 'block';
        }
        
        /* ---------- é€šç”¨å·¥å…·å‡½æ•° ---------- */
        const $ = id => document.getElementById(id)

        // é€‰é¡¹å¡åˆ‡æ¢åŠŸèƒ½
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'))
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'))
                
                // æ·»åŠ å½“å‰æ´»åŠ¨çŠ¶æ€
                btn.classList.add('active')
                $(btn.dataset.tab).classList.add('active')
            })
        })

        /* ---------- å‡¯åœ£ç‹ç¢³å¾ªç¯åŠŸèƒ½ ---------- */
        // èƒšå‹é€‰æ‹©
        const bodyCards = [...document.querySelectorAll('.body-type-card')]
        bodyCards.forEach(c => c.addEventListener('click', () => {
            bodyCards.forEach(x => x.classList.remove('selected'))
            c.classList.add('selected')
            setMacros(c.dataset.type)
        }))
        function setMacros(type){
            const map = {ectomorph:{c:3,p:1.3,f:1.1},mesomorph:{c:2.5,p:1.3,f:0.9},endomorph:{c:2,p:1.3,f:0.8}}
            $('carbsPerKg').value = map[type].c
            $('proteinPerKg').value = map[type].p
            $('fatPerKg').value = map[type].f
            calcKingsCycle()
        }

        // æ˜¾ç¤º/éšè—è‡ªå®šä¹‰è¾“å…¥
        const planCards = [...document.querySelectorAll('.plan-card')]
        const customDiv = $('customPlan')
        planCards.forEach(c => c.addEventListener('click', () => {
            planCards.forEach(x => x.classList.remove('selected'))
            c.classList.add('selected')
            customDiv.style.display = c.dataset.plan === 'custom' ? 'flex' : 'none'
            calcKingsCycle()
        }))

        // è®­ç»ƒéƒ¨ä½ç”Ÿæˆ
        function buildParts(plan){
            switch(plan){
                case '1': return ['ä¼‘æ¯','èƒ¸+ä¸‰å¤´','ä¼‘æ¯','èƒŒ+äºŒå¤´','ä¼‘æ¯','è…¿+è‚©','ä¼‘æ¯']
                case '2': return ['èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','ä¼‘æ¯','è…¿+è‚©','èƒ¸+ä¸‰å¤´','ä¼‘æ¯','èƒŒ+äºŒå¤´']
                case '3': return ['èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','è…¿+è‚©','ä¼‘æ¯','èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','è…¿+è‚©']
                case '4': return ['èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','è…¿+è‚©','èƒ¸+ä¸‰å¤´','ä¼‘æ¯','èƒŒ+äºŒå¤´','è…¿+è‚©']
                case 'custom':
                    return ['mon','tue','wed','thu','fri','sat','sun'].map(d=>$(`cus-${d}`).value.trim()||'ä¼‘æ¯')
            }
        }

        // ç¢³æ°´å¹³æ˜ å°„ç”Ÿæˆï¼ˆæ ¹æ®è®­ç»ƒè®¡åˆ’ï¼‰
        function buildCarbMap(plan, parts) {
            const isRestDay = parts.map(part => part === 'ä¼‘æ¯');
            const trainingDays = [];
            const restDays = [];
            isRestDay.forEach((isRest, index) => {
                if (isRest) restDays.push(index);
                else trainingDays.push(index);
            });
            const carbPatterns = [
                ['é«˜','ä¸­','ä½','é«˜','ä¸­','ä½','ä¸­'],
                ['é«˜','ä½','ä¸­','é«˜','ä½','ä¸­','ä¸­'],
                ['ä¸­','é«˜','ä½','ä¸­','é«˜','ä½','ä¸­'],
                ['ä¸­','ä½','é«˜','ä¸­','ä½','é«˜','ä¸­'],
                ['ä½','é«˜','ä¸­','ä½','é«˜','ä¸­','ä¸­'],
                ['ä½','ä¸­','é«˜','ä½','ä¸­','é«˜','ä¸­'],
                ['ä¸­','ä¸­','é«˜','ä½','ä¸­','é«˜','ä½']
            ];
            const validPatterns = carbPatterns.filter(pattern => {
                const highCount = pattern.filter(level => level === 'é«˜').length;
                if (highCount !== 2) return false;
                const medCount = pattern.filter(level => level === 'ä¸­').length;
                if (medCount !== 3) return false;
                const lowCount = pattern.filter(level => level === 'ä½').length;
                if (lowCount !== 2) return false;
                for (let i = 0; i < 7; i++) {
                    if (pattern[i] === 'é«˜' && isRestDay[i]) return false;
                }
                return true;
            });
            if (validPatterns.length === 0) {
                const defaultPattern = ['ä¸­','é«˜','ä½','ä¸­','ä½','é«˜','ä¸­'];
                for (let i = 0; i < 7; i++) {
                    if (defaultPattern[i] === 'é«˜' && isRestDay[i]) {
                        for (let j = 0; j < 7; j++) {
                            if (!isRestDay[j] && defaultPattern[j] !== 'é«˜') {
                                const temp = defaultPattern[j];
                                defaultPattern[j] = defaultPattern[i];
                                defaultPattern[i] = temp;
                                break;
                            }
                        }
                    }
                }
                return defaultPattern;
            }
            return validPatterns[Math.floor(Math.random() * validPatterns.length)];
        }

        // å‡¯åœ£ç‹ç¢³å¾ªç¯ä¸»è®¡ç®—
        function calcKingsCycle(){
            const w=+$('weight').value,h=+$('height').value,a=+$('age').value,g=$('gender').value
            const targetW = +$('targetWeight').value
            if(!w||!h||!a||!targetW){alert('è¯·è¡¥å…¨ä¿¡æ¯');return}
            const cp=+$('carbsPerKg').value,pp=+$('proteinPerKg').value,fp=+$('fatPerKg').value
            const plan=document.querySelector('.plan-card.selected').dataset.plan

            const bmr=g==='male'?10*w+6.25*h-5*a+5:10*w+6.25*h-5*a-161
            const tdee=bmr+500
            const pro=Math.round(pp*targetW)
            const weekC=Math.round(cp*targetW*7)
            const weekF=Math.round(fp*targetW*7)
            const hc=Math.round(weekC*.5/2)
            const mc=Math.round(weekC*.35/3)
            const lc=Math.round(weekC*.15/2)
            const hf=Math.round(weekF*.15/2)
            const mf=Math.round(weekF*.35/3)
            const lf=Math.round(weekF*.50/2)

            $('bmrValue').textContent=Math.round(bmr)
            $('tdeeValue').textContent=Math.round(tdee)
            $('proteinValue').textContent=pro
            $('carbsValue').textContent=weekC

            const parts=buildParts(plan)
            const carbMap=buildCarbMap(plan, parts)
            const dayKeys=['mon','tue','wed','thu','fri','sat','sun']
            const carbNum=dayKeys.map((_,i)=>{
                switch(carbMap[i]){
                    case 'é«˜':return hc
                    case 'ä¸­':return mc
                    case 'ä½':return lc
                }
            })
            const fats=dayKeys.map((_,i)=>{
                switch(carbMap[i]){
                    case 'é«˜':return hf
                    case 'ä¸­':return mf
                    case 'ä½':return lf
                }
            })

            const trParts=document.querySelector('#planTable tbody tr:nth-child(1)')
            const trLevel=document.querySelector('#carbLevelRow')
            parts.forEach((p,i)=>{
                trParts.children[i+1].textContent=p
                trLevel.children[i].className=carbMap[i]==='é«˜'?'high':(carbMap[i]==='ä¸­'?'med':'low')
                trLevel.children[i].textContent=carbMap[i]
            })

            const dailyDiffs=[]
            dayKeys.forEach((d,i)=>{
                $(`carb-${d}`).textContent=carbNum[i]
                $(`protein-${d}`).textContent=pro
                $(`fat-${d}`).textContent=fats[i]
                const cal=carbNum[i]*4+pro*4+fats[i]*9
                $(`cal-${d}`).textContent=cal
                const diff=Math.round(cal - tdee)
                dailyDiffs.push(diff)
                $(`diff-${d}`).innerHTML=`<span style="color:${diff>0?(diff>300?'#10b981':'#f59e0b'):'#f43f5e'}">${diff>0?'+':''}${diff}</span>`
            })

            const weightDiff = targetW - w
            const weeklyCalorieDiff = dailyDiffs.reduce((sum, diff) => sum + diff, 0)
            let daysNeeded = 0
            let targetDateText = ''
            if (weightDiff > 0 && weeklyCalorieDiff < 0) {
                targetDateText = 'æ— æ³•å®Œæˆï¼Œè¯·å¢åŠ ç¢³æ°´'
            } else if (weightDiff < 0 && weeklyCalorieDiff > 0) {
                targetDateText = 'æ— æ³•å®Œæˆï¼Œè¯·å‡å°‘ç¢³æ°´'
            } else if (weeklyCalorieDiff === 0) {
                targetDateText = 'çƒ­é‡å¹³è¡¡ï¼Œè¯·è°ƒæ•´è®¡åˆ’'
            } else {
                daysNeeded = Math.abs(Math.round((weightDiff * 7700) / (weeklyCalorieDiff / 7)))
                const today = new Date()
                const targetDate = new Date(today)
                targetDate.setDate(today.getDate() + daysNeeded)
                targetDateText = targetDate.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric' })
            }
            $('weightDiffValue').textContent = weightDiff > 0 ? `+${weightDiff}` : weightDiff
            $('weightDiffValue').style.color = weightDiff > 0 ? '#10b981' : (weightDiff < 0 ? '#f43f5e' : '#334155')
            $('weeklyCalorieDiffValue').textContent = weeklyCalorieDiff > 0 ? `+${weeklyCalorieDiff}` : weeklyCalorieDiff
            $('weeklyCalorieDiffValue').style.color = weeklyCalorieDiff > 0 ? '#10b981' : (weeklyCalorieDiff < 0 ? '#f43f5e' : '#334155')
            $('daysNeededValue').textContent = daysNeeded || 'â€”'
            $('targetDate').textContent = targetDateText
        }

        // å‡¯åœ£ç‹ç¢³å¾ªç¯å¯¼å‡º & é‡ç½®
        function dlKingsCycle() {
            const w   = +$('weight').value;
            const tgt = +$('targetWeight').value;
            const h   = +$('height').value;
            const a   = +$('age').value;
            const g   = $('gender').value === 'male' ? 'ç”·' : 'å¥³';
            const bmr = +$('bmrValue').textContent;
            const tdee= +$('tdeeValue').textContent;
            const pro = +$('proteinValue').textContent;
            const weekCarb = +$('carbsValue').textContent;
            const weightDiff  = +$('weightDiffValue').textContent;
            const weekDiffKcal= +$('weeklyCalorieDiffValue').textContent;
            const daysNeed    = $('daysNeededValue').textContent;
            const finishDate  = $('targetDate').textContent;

            const basicRows = [
                ['åŸºç¡€ä¿¡æ¯','','','','','','',''],
                ['å½“å‰ä½“é‡(kg)', w,'','','','','',''],
                ['ç›®æ ‡ä½“é‡(kg)', tgt,'','','','','',''],
                ['èº«é«˜(cm)', h,'','','','','',''],
                ['å¹´é¾„(å²)', a,'','','','','',''],
                ['æ€§åˆ«', g,'','','','','',''],
                ['åŸºç¡€ä»£è°¢(kcal)', bmr,'','','','','',''],
                ['æ¯æ—¥æ€»æ¶ˆè€—(kcal)', tdee,'','','','','',''],
                ['æ¯æ—¥è›‹ç™½(g)', pro,'','','','','',''],
                ['æ¯å‘¨ç¢³æ°´(g)', weekCarb,'','','','','',''],
                ['','','','','','','',''],
                ['ç›®æ ‡åˆ†æ','','','','','','',''],
                ['ä½“é‡å·®(kg)', weightDiff,'','','','','',''],
                ['å‘¨çƒ­é‡å·®(kcal)', weekDiffKcal,'','','','','',''],
                ['é¢„è®¡å¤©æ•°', daysNeed,'','','','','',''],
                ['é¢„è®¡å®Œæˆæ—¥æœŸ', finishDate,'','','','','',''],
                ['','','','','','','','']
            ];

            const thead = ['é¡¹ç›®','å‘¨ä¸€','å‘¨äºŒ','å‘¨ä¸‰','å‘¨å››','å‘¨äº”','å‘¨å…­','å‘¨æ—¥'];
            const planRows = [thead];
            const parts = Array.from(document.querySelectorAll('#planTable tbody tr:nth-child(1) td')).slice(1).map(td=>td.textContent);
            planRows.push(['è®­ç»ƒéƒ¨ä½', ...parts]);
            const levels = Array.from(document.querySelectorAll('#carbLevelRow th')).map(th=>th.textContent);
            planRows.push(['ç¢³æ°´å¹³', ...levels]);
            const labels = ['ç¢³æ°´(g)','è›‹ç™½è´¨(g)','è„‚è‚ª(g)','çƒ­é‡(kcal)','ç¼ºå£/ç›ˆä½™(kcal)'];
            [2,3,4,5,6].forEach(i=>{
                const tds = Array.from(document.querySelectorAll(`#planTable tbody tr:nth-child(${i}) td`)).slice(1);
                planRows.push([labels[i-2], ...tds.map(td=>td.textContent)]);
            });

            const fullData = [...basicRows, ...planRows];
            const ws = XLSX.utils.aoa_to_sheet(fullData);
            const range = XLSX.utils.decode_range(ws['!ref']);
            for (let R = 0; R <= range.e.r; R++) {
                for (let C = range.s.c; C <= range.e.c; C++) {
                    const cell = ws[XLSX.utils.encode_cell({r:R, c:C})];
                    if (!cell) continue;
                    cell.s = cell.s || {};
                    if (R < basicRows.length && C === 0) { cell.s.font = {bold:true}; }
                    if (R === basicRows.length + 1) {
                        cell.s.font = {bold:true, color:{rgb:"FFFFFF"}};
                        cell.s.fill = {fgColor:{rgb:"0284c7"}, patternType:"solid"};
                    }
                }
            }
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'ç¢³å¾ªç¯å®Œæ•´è®¡åˆ’');
            XLSX.writeFile(wb, `ç¢³å¾ªç¯_${w}kg.xlsx`);
        }

        function resetKingsCycle(){
            $('weight').value=75;
            $('targetWeight').value=70;
            $('height').value=178;
            $('age').value=30;
            $('gender').value='male'
            bodyCards[0].click()
            planCards[0].click()
            ;['mon','tue','wed','thu','fri','sat','sun'].forEach(d=>$(`cus-${d}`).value='')
            calcKingsCycle()
        }

        function clipTargetWeight(){
            const w   = +$('weight').value;
            const tgt = $('targetWeight');
            let v = +tgt.value;
            v = Math.min(Math.max(v, w - 5), w + 5);
            if(v !== +tgt.value) tgt.value = v;
        }

        function adjustTarget(delta){
            const el = $('targetWeight');
            let v = +el.value + delta;
            const w = +$('weight').value;
            v = Math.min(Math.max(v, w - 5), w + 5);
            el.value = v;
            clipTargetWeight();
        }

        /* ---------- æ©™å­ç¢³æ°´æ¸é™åŠŸèƒ½ ---------- */
        // è¥å…»ç´ æ¯”ä¾‹é€‰æ‹©
        const ratioCards = [...document.querySelectorAll('.orange-ratio-card')]
        ratioCards.forEach(c => c.addEventListener('click', () => {
            ratioCards.forEach(x => x.classList.remove('selected'))
            c.classList.add('selected')
            
            // æ˜¾ç¤º/éšè—è‡ªå®šä¹‰æ¯”ä¾‹è¾“å…¥
            const customInputs = $('custom-ratio-inputs')
            customInputs.style.display = c.dataset.ratio === 'custom' ? 'block' : 'none'
            
            calcOrangeCarb()
        }))

        // è‡ªå®šä¹‰æ¯”ä¾‹è¾“å…¥éªŒè¯
        function validateCustomRatio() {
            const carb = +$('custom-carb').value || 0
            const protein = +$('custom-protein').value || 0
            const fat = +$('custom-fat').value || 0
            const total = carb + protein + fat
            
            const ratioSum = $('ratio-sum')
            ratioSum.textContent = `æ€»å’Œ: ${total}%`
            
            if (total !== 100) {
                ratioSum.classList.add('error')
                return false
            } else {
                ratioSum.classList.remove('error')
                return true
            }
        }

        // ç›‘å¬è‡ªå®šä¹‰æ¯”ä¾‹è¾“å…¥å˜åŒ–
        document.querySelectorAll('#custom-carb, #custom-protein, #custom-fat').forEach(input => {
            input.addEventListener('input', () => {
                validateCustomRatio()
                calcOrangeCarb()
            })
        })

        // å‡é‡ç™¾åˆ†æ¯”æ»‘å—
        const weightLossSlider = $('weight-loss-percent')
        const weightLossValue = $('weight-loss-value')
        
        weightLossSlider.addEventListener('input', () => {
            weightLossValue.textContent = `${weightLossSlider.value}%`
            calcOrangeCarb()
        })

        // æ©™å­ç¢³æ°´æ¸é™ä¸»è®¡ç®—
        function calcOrangeCarb(){
            const w = +$('orange-weight').value
            const h = +$('orange-height').value
            const a = +$('orange-age').value
            const g = $('orange-gender').value
            const trainTime = +$('train-time').value
            const intensity = +$('train-intensity').value
            const weightLossPercent = +weightLossSlider.value / 100 // è½¬æ¢ä¸ºå°æ•°
            const weeklyLossPercent = weightLossPercent / 4.33; 
            // è·å–é€‰ä¸­çš„æ¯”ä¾‹
            const selectedRatio = document.querySelector('.orange-ratio-card.selected').dataset.ratio
            let carbRatio, proteinRatio, fatRatio
            
            if(selectedRatio === 'custom') {
                if (!validateCustomRatio()) return
                carbRatio = (+$('custom-carb').value || 0) / 100
                proteinRatio = (+$('custom-protein').value || 0) / 100
                fatRatio = (+$('custom-fat').value || 0) / 100
            } else if(selectedRatio === '532') {
                carbRatio = 0.5
                proteinRatio = 0.3
                fatRatio = 0.2
            } else {
                carbRatio = 0.4
                proteinRatio = 0.4
                fatRatio = 0.2
            }
            
            if(!w || !h || !a || !trainTime){alert('è¯·è¡¥å…¨ä¿¡æ¯');return}
            
            // è®¡ç®—BMR
            const bmr = g === 'male' ? 10*w + 6.25*h - 5*a + 5 : 10*w + 6.25*h - 5*a - 161
            
            // è®¡ç®—è®­ç»ƒæ¶ˆè€—çƒ­é‡
            const trainCalories = trainTime * intensity
            
            // è®¡ç®—TDEE
            const tdee = Math.round(bmr + trainCalories)
            
            // è®¡ç®—åˆå§‹ç¢³æ°´
            const initialCarbs = Math.round(tdee * carbRatio / 4)
            
            // è®¡ç®—è›‹ç™½è´¨å’Œè„‚è‚ª
            const protein = Math.round(tdee * proteinRatio / 4)
            const fat = Math.round(tdee * fatRatio / 9)
            
            // è®¡ç®—å‘¨å‡é‡ç›®æ ‡ (æ ¹æ®ç”¨æˆ·è®¾ç½®çš„ç™¾åˆ†æ¯”)
            const weeklyLoss = Math.round(w * weeklyLossPercent * 100) / 100
            
            // è®¡ç®—é¢„è®¡å‘¨æ•°å’Œå®Œæˆæ—¥æœŸ
            const targetWeightLoss = w * 0.15 // å‡è®¾ç›®æ ‡å‡é‡15%
            const estimatedWeeks = Math.round(targetWeightLoss / weeklyLoss)
            const today = new Date()
            const targetDate = new Date(today)
            targetDate.setDate(today.getDate() + estimatedWeeks * 7)
            const formattedDate = targetDate.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric' })
            
            // æ›´æ–°æ˜¾ç¤º
            $('orange-bmrValue').textContent = Math.round(bmr)
            $('orange-trainCalories').textContent = trainCalories
            $('orange-tdeeValue').textContent = tdee
            $('orange-initialCarbs').textContent = initialCarbs
            $('orange-protein').textContent = protein
            $('orange-fat').textContent = fat
            $('orange-weeklyLoss').textContent = weeklyLoss
            
            
            // ç”Ÿæˆç¢³æ°´æ¸é™è®¡åˆ’è¡¨
            generateOrangePlan(initialCarbs, protein, fat, weeklyLoss, estimatedWeeks, w)
        }

        // ç”Ÿæˆç¢³æ°´æ¸é™è®¡åˆ’è¡¨
        // ç”Ÿæˆç¢³æ°´æ¸é™è®¡åˆ’è¡¨ï¼ˆæ— å‘¨æ•°ã€æ— æ—¥æœŸç‰ˆï¼‰
function generateOrangePlan(initialCarbs, protein, fat, weeklyLoss, estimatedWeeks, initialWeight) {
  const planBody = $('orange-planBody');
  planBody.innerHTML = '';

  let currentCarbs = initialCarbs;
  const adjustment = 15;               // æ¯æ¬¡ä¸‹è°ƒ 15 g
  let seq = 1;                         // è¡Œå·ä» 1 å¼€å§‹

  for (let week = 1; week <= estimatedWeeks + 2; week++) {
    const expectedWeight = Math.max(initialWeight - (week - 1) * weeklyLoss, initialWeight * 0.85);

    if (currentCarbs < 100) {          // ä½äº 100 g åœæ­¢
      planBody.insertAdjacentHTML('beforeend', `
        <tr>
          <td>${seq++}</td>
          <td>${currentCarbs}</td>
          <td>${protein}</td>
          <td>${fat}</td>
          <td>${expectedWeight.toFixed(1)}</td>
          <td>${weeklyLoss}</td>
          <td>ç¢³æ°´å·²ä½äº 100 gï¼Œå»ºè®®åœæ­¢å‡å°‘</td>
        </tr>`);
      break;
    }

    planBody.insertAdjacentHTML('beforeend', `
      <tr>
        <td>${seq++}</td>
        <td>${currentCarbs}</td>
        <td>${protein}</td>
        <td>${fat}</td>
        <td>${expectedWeight.toFixed(1)}</td>
        <td>${weeklyLoss}</td>
        <td>${week === 1 ? 'åˆå§‹ç¢³æ°´æ‘„å…¥' : 'å¦‚æœªè¾¾ç›®æ ‡,å‡å°‘15gç¢³æ°´'}</td>
      </tr>`);

    currentCarbs -= adjustment;
  }
}

        // æ©™å­ç¢³æ°´æ¸é™å¯¼å‡ºåŠŸèƒ½
        // æ©™å­ç¢³æ°´æ¸é™å¯¼å‡ºåŠŸèƒ½ï¼ˆä¿®å¤ç‰ˆï¼‰
function dlOrangeCarb() {
    const w = +$('orange-weight').value,
          h = +$('orange-height').value,
          a = +$('orange-age').value,
          g = $('orange-gender').value === 'male' ? 'ç”·' : 'å¥³',
          trainTime = +$('train-time').value,
          intensity = +$('train-intensity').value,
          weightLossPercent = +$('weight-loss-percent').value;

    const ratioCard = document.querySelector('.orange-ratio-card.selected'),
          ratioText = ratioCard.dataset.ratio === 'custom'
              ? `è‡ªå®šä¹‰: ${$('custom-carb').value}%ç¢³æ°´, ${$('custom-protein').value}%è›‹ç™½, ${$('custom-fat').value}%è„‚è‚ª`
              : ratioCard.dataset.ratio === '532'
                  ? '50%ç¢³æ°´ 30%è›‹ç™½ 20%è„‚è‚ª'
                  : '40%ç¢³æ°´ 40%è›‹ç™½ 20%è„‚è‚ª';

    const bmr = +$('orange-bmrValue').textContent,
          trainCal = +$('orange-trainCalories').textContent,
          tdee = +$('orange-tdeeValue').textContent,
          initCarb = +$('orange-initialCarbs').textContent,
          protein = +$('orange-protein').textContent,
          fat = +$('orange-fat').textContent,
          weeklyLoss = +$('orange-weeklyLoss').textContent;

    /* ---------- åŸºç¡€ä¿¡æ¯éƒ¨åˆ† ---------- */
    const basic = [
        ['åŸºç¡€ä¿¡æ¯','','','','','','',''],
        ['å½“å‰ä½“é‡(kg)', w],
        ['èº«é«˜(cm)', h],
        ['å¹´é¾„(å²)', a],
        ['æ€§åˆ«', g],
        ['è®­ç»ƒæ—¶é•¿(åˆ†é’Ÿ)', trainTime],
        ['è®­ç»ƒå¼ºåº¦ç³»æ•°', intensity],
        ['æ¯æœˆå‡é‡ç™¾åˆ†æ¯”', `${weightLossPercent}%`],
        ['è¥å…»ç´ æ¯”ä¾‹', ratioText],
        [], [],
        ['è®¡ç®—ç»“æœ'],
        ['åŸºç¡€ä»£è°¢(BMR)', bmr],
        ['è®­ç»ƒæ¶ˆè€—çƒ­é‡', trainCal],
        ['æ¯æ—¥æ€»æ¶ˆè€—(TDEE)', tdee],
        ['åˆå§‹ç¢³æ°´(g)', initCarb],
        ['è›‹ç™½è´¨(g)', protein],
        ['è„‚è‚ª(g)', fat],
        ['å‘¨å‡é‡ç›®æ ‡(kg)', weeklyLoss],
        [], []
    ];

    /* ---------- è®¡åˆ’è¡¨éƒ¨åˆ† ---------- */
    const plan = [
        ['ç¢³æ°´æ¸é™è®¡åˆ’'],
        ['å‘¨æ•°','æ¯æ—¥ç¢³æ°´(g)','æ¯æ—¥è›‹ç™½è´¨(g)','æ¯æ—¥è„‚è‚ª(g)','é¢„æœŸä½“é‡(kg)','å‘¨å‡é‡ç›®æ ‡(kg)','è°ƒæ•´è¯´æ˜']
    ];
    Array.from($('orange-planBody').querySelectorAll('tr')).forEach(tr => {
        plan.push(Array.from(tr.querySelectorAll('td')).map(td => td.textContent));
    });

    const data = [...basic, ...plan];
    const ws = XLSX.utils.aoa_to_sheet(data);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'ç¢³æ°´æ¸é™è®¡åˆ’');
    XLSX.writeFile(wb, `ç¢³æ°´æ¸é™_${w}kg.xlsx`);
}

        // æ©™å­ç¢³æ°´æ¸é™é‡ç½®åŠŸèƒ½
        function resetOrangeCarb(){
            $('orange-weight').value = 80
            $('orange-height').value = 175
            $('orange-age').value = 32
            $('orange-gender').value = 'male'
            $('train-time').value = 60
            $('train-intensity').value = 8
            weightLossSlider.value = 3.5
            weightLossValue.textContent = '3.5%'
            ratioCards[0].click()
            $('custom-carb').value = 50
            $('custom-protein').value = 30
            $('custom-fat').value = 20
            validateCustomRatio()
            calcOrangeCarb()
        }

        /* ---------- äº‹ä»¶ç»‘å®š ---------- */
        // å‡¯åœ£ç‹ç¢³å¾ªç¯äº‹ä»¶
        $('calculateBtn').addEventListener('click', calcKingsCycle)
        $('downloadBtn').addEventListener('click', dlKingsCycle)
        $('resetBtn').addEventListener('click', resetKingsCycle)

        // æ©™å­ç¢³æ°´æ¸é™äº‹ä»¶
        $('orange-calculateBtn').addEventListener('click', calcOrangeCarb)
        $('orange-downloadBtn').addEventListener('click', dlOrangeCarb)
        $('orange-resetBtn').addEventListener('click', resetOrangeCarb)

        // è®­ç»ƒéƒ¨ä½å•å…ƒæ ¼åŒå‡»ç¼–è¾‘
        document.querySelectorAll('.editable').forEach(cell=>{
            cell.addEventListener('dblclick',()=>{
                const v=cell.textContent
                cell.innerHTML=`<input value="${v}" style="width:100%;font-size:.7rem">`
                const inp=cell.querySelector('input')
                inp.focus()
                inp.onblur=inp.onkeydown=e=>{
                    if(e.type==='blur'||e.key==='Enter'){cell.textContent=inp.value||v}
                }
            })
        })
	function toggleBodyFatImage() {
    const container = document.getElementById('bodyfat-container');
    if (container.style.display === 'none') {
        container.style.display = 'block';
    } else {
        container.style.display = 'none';
    }
}
/* èƒšå‹å‚è€ƒå›¾æ˜¾éš */
function toggleBodyTypeRef() {
  const box = document.getElementById('bodytype-ref');
  const link = event.currentTarget;
  if (box.style.display === 'none') {
    box.style.display = 'block';
    link.textContent = 'ğŸ“Œ éšè—èƒšå‹å‚è€ƒå›¾';
  } else {
    box.style.display = 'none';
    link.textContent = 'ğŸ“Œ ç‚¹å‡»æŸ¥çœ‹èƒšå‹å‚è€ƒå›¾';
  }
}
        /* ---------- åˆå§‹åŒ– ---------- */
        setMacros('ectomorph')
        calcKingsCycle();
        clipTargetWeight();
        
        // åˆå§‹åŒ–æ©™å­ç¢³æ°´æ¸é™
        weightLossValue.textContent = `${weightLossSlider.value}%`
        validateCustomRatio()
        calcOrangeCarb();
    </script>
<!-- ========= 1. å…¨å±æ°´å° ========= -->
<script>
(function(){
  const canvas = document.createElement('canvas');
  const ctx    = canvas.getContext('2d');
  canvas.width = 320;
  canvas.height = 320;
  ctx.font = 'bold 20px sans-serif';
  ctx.fillStyle = 'rgba(60,60,60,0.25)'; // æ·±ç° 35% ä¸é€æ˜åº¦
  ctx.textAlign = 'center';
  ctx.translate(160,160);
  ctx.rotate(-Math.PI/6);
  ctx.fillText('Â© é˜¿äº®å¥èº«,ç¦æ­¢è½¬è½½/å•†ç”¨',0,0);
  ctx.rotate(Math.PI/6);
  const div = document.createElement('div');
  div.style.cssText = 'position:fixed;top:0;left:0;width:100vw;height:100vh;pointer-events:none;z-index:9999;background:url('+canvas.toDataURL()+') repeat';
  document.body.appendChild(div);
})();
</script>

<!-- ========= 2. ç¦ç”¨å³é”® & å¸¸ç”¨å¼€å‘è€…å¿«æ·é”® ========= -->
<script>
['contextmenu','keydown'].forEach(function(ev){
  document.addEventListener(ev,function(e){
    if(ev==='contextmenu'||
       (ev==='keydown' && (
         e.ctrlKey&&e.shiftKey&&(e.key==='I'||e.key==='J') ||
         e.ctrlKey&&e.key==='U' ||
         e.key==='F12'
       ))){
      e.preventDefault(); return false;
    }
  });
});
</script>

<!-- ========= 3. å¤åˆ¶æ—¶è¿½åŠ ç‰ˆæƒ ========= -->
<script>
document.addEventListener('copy',function(e){
  const sel = window.getSelection().toString();
  if(!sel) return;
  const copyText = sel + '\n\nÂ© 2025 é˜¿äº®å¥èº« | æœªæˆæƒä»…é™ä¸ªäººä½¿ç”¨ | ç¦æ­¢è½¬è½½ã€å•†ç”¨ | è¿è€…å¿…ç©¶';
  e.clipboardData.setData('text/plain', copyText);
  e.preventDefault();
});
</script>

<!-- ========= 4. é¡µé¢åº•éƒ¨å›ºå®šç‰ˆæƒæ  ========= -->
<style>
#copyright-bar{
  position:fixed;
  left:0;right:0;bottom:0;
  height:32px;
  background:#0ea5e9;
  color:#fff;
  font-size:13px;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:10000;
  letter-spacing:.5px;
}
</style>
<div id="copyright-bar">
  Â© 2025 é˜¿äº®å¥èº« | ä»…é™ä¸ªäººä½¿ç”¨ | ç¦æ­¢è½¬è½½ã€å•†ç”¨ | è¿è€…å¿…ç©¶
</div>
</body>
</html>
